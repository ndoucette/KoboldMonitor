<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GemStone IV Bot Monitor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: "Courier New", monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #00ffff;
            font-size: 24px;
            margin-bottom: 5px;
            text-shadow: 0 0 10px #00ffff;
        }

        .header p {
            color: #cccccc;
            font-size: 14px;
            margin: 0;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .character-tile {
            background: linear-gradient(145deg, #2a2a3e, #1a1a2e);
            border: 1px solid #444444;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            transition: all 0.3s ease;
            min-height: 450px;
        }

        .top-section {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .manequin-section {
            flex: 0 0 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stats-section {
            flex: 0 0 50%;
        }

        .progress-bar-container {
            height: 16px;
            background-color: #333333;
            border: 1px solid #555555;
            border-radius: 8px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-bar-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 7px;
        }

        .progress-bar-fill.level-progress {
            background: linear-gradient(90deg, #00cc00, #66ff66);
        }

        .progress-bar-fill.capped-progress {
            background: linear-gradient(90deg, #0099cc, #33ccff);
        }

        .progress-label {
            font-size: 11px;
            color: #cccccc;
            margin-bottom: 2px;
            display: flex;
            justify-content: space-between;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 9px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            color: #ffffff;
            z-index: 1;
        }

        .character-tile:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .inactive-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 0, 0, 0.3);
            border-radius: 8px;
            animation: blink 1s infinite alternate;
            pointer-events: none;
        }

        @keyframes blink {
            0% { opacity: 0.3; }
            100% { opacity: 0.6; }
        }

        .character-name {
            font-size: 16px;
            font-weight: bold;
            color: #00ffff;
            text-align: center;
            margin-bottom: 5px;
            text-shadow: 0 0 5px #00ffff;
        }

        .character-location {
            font-size: 11px;
            color: #cccccc;
            text-align: center;
            margin-bottom: 15px;
        }

        .room-title {
            color: #ffcc00;
            font-weight: bold;
        }

        .effects-section {
            margin-top: 15px;
            border-top: 1px solid #444444;
            padding-top: 10px;
        }

        .effects-toggle {
            background: none;
            border: none;
            color: #00ffff;
            cursor: pointer;
            font-size: 12px;
            margin-bottom: 10px;
            text-decoration: underline;
            padding: 0;
        }

        .effects-toggle:hover {
            color: #66ffff;
        }

        .effects-list {
            display: none;
        }

        .effects-list.expanded {
            display: block;
        }

        .effect-category {
            margin-bottom: 10px;
        }

        .effect-category-title {
            font-size: 11px;
            color: #ffcc00;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .effect-bar {
            margin-bottom: 4px;
        }

        .effect-label {
            font-size: 10px;
            margin-bottom: 2px;
            display: flex;
            justify-content: space-between;
        }

        .effect-progress {
            height: 12px;
            background-color: #333333;
            border: 1px solid #555555;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .effect-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 5px;
        }

        .effect-fill.spell {
            background: linear-gradient(90deg, #9933cc, #cc66ff);
        }

        .effect-fill.buff {
            background: linear-gradient(90deg, #00cc66, #66ff99);
        }

        .effect-fill.debuff {
            background: linear-gradient(90deg, #cc3300, #ff6633);
        }

        .effect-fill.cooldown {
            background: linear-gradient(90deg, #666666, #999999);
        }

        .effect-time {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            color: #ffffff;
            z-index: 1;
        }

        .stats-section {
            margin-bottom: 10px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .stat-label {
            color: #cccccc;
        }

        .stat-value {
            color: #ffffff;
            font-weight: bold;
            padding-right: 15px;
        }

        .vitals-section {
            margin: 15px 0;
        }

        .vital-bar {
            margin-bottom: 8px;
        }

        .vital-label {
            font-size: 11px;
            margin-bottom: 2px;
            display: flex;
            justify-content: space-between;
        }

        .bar-container {
            height: 18px;
            background-color: #333333;
            border: 1px solid #555555;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            transition: width 0.5s ease;
            position: relative;
        }

        .bar-fill.health {
            background: linear-gradient(90deg, #cc0000, #ff3333);
        }

        .bar-fill.mana {
            background: linear-gradient(90deg, #0066cc, #3399ff);
        }

        .bar-fill.stamina {
            background: linear-gradient(90deg, #cc6600, #ff9933);
        }

        .bar-fill.spirit {
            background: linear-gradient(90deg, #6600cc, #9933ff);
        }

        .bar-fill.mindstate {
            background: linear-gradient(90deg, #ffaa00, #ffcc66);
        }

        .bar-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            color: #ffffff;
            z-index: 1;
        }

        .level-section {
            background-color: rgba(0, 102, 204, 0.2);
            padding: 8px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 12px;
            border: 1px solid #0066cc;
        }

        .capped-section {
            background-color: rgba(0, 153, 204, 0.2);
            padding: 8px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 12px;
            border: 1px solid #0099cc;
        }

        .injury-indicator {
            color: #ff6666;
            font-weight: bold;
        }

        .no-characters {
            text-align: center;
            color: #888888;
            font-size: 18px;
            margin-top: 100px;
            grid-column: 1 / -1;
        }

        .last-update {
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 9px;
            color: #888888;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .debug-button {
            position: fixed;
            top: 10px;
            right: 120px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            background-color: #ff9900;
            color: #ffffff;
            border: none;
            cursor: pointer;
        }

        .debug-button:hover {
            background-color: #ffaa00;
        }

        .connected {
            background-color: #00cc00;
            color: #ffffff;
        }

        .disconnected {
            background-color: #cc0000;
            color: #ffffff;
        }

        .manequin-container {
            width: 80px;
            height: 120px;
            position: relative;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 120"><path d="M40 5 C50 5 55 15 55 25 C55 30 50 35 45 35 L45 45 C50 45 60 50 60 70 L60 85 C65 85 70 90 70 100 L70 115 L55 115 L55 105 C55 100 50 95 45 95 L35 95 C30 95 25 100 25 105 L25 115 L10 115 L10 100 C10 90 15 85 20 85 L20 70 C20 50 30 45 35 45 L35 35 C30 35 25 30 25 25 C25 15 30 5 40 5 Z" fill="%23444444" stroke="%23666666" stroke-width="1"/></svg>') center center no-repeat;
            background-size: contain;
        }

        .injury-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            border: 1px solid #000;
        }

        .injury-level-1 { background-color: #ffff00; }
        .injury-level-2 { background-color: #ff0000; }
        .injury-level-3 { background-color: #aa0000; }

        /* Injury position mapping */
        .injury-head { top: 8px; left: 37px; }
        .injury-neck { top: 18px; left: 37px; }
        .injury-chest { top: 28px; left: 37px; }
        .injury-abdomen { top: 38px; left: 37px; }
        .injury-back { top: 28px; left: 47px; }
        .injury-leftArm { top: 30px; left: 25px; }
        .injury-rightArm { top: 30px; left: 50px; }
        .injury-leftHand { top: 42px; left: 20px; }
        .injury-rightHand { top: 42px; left: 55px; }
        .injury-leftLeg { top: 70px; left: 32px; }
        .injury-rightLeg { top: 70px; left: 43px; }
        .injury-leftFoot { top: 105px; left: 30px; }
        .injury-rightFoot { top: 105px; left: 45px; }
        .injury-leftEye { top: 10px; left: 35px; }
        .injury-rightEye { top: 10px; left: 42px; }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">Connecting...</div>
    <button class="debug-button" onclick="addTestCharacter()">Debug Test</button>
    
    <div class="header">
        <h1>GemStone IV Bot Monitor</h1>
        <p>Real-time monitoring of your bot army</p>
    </div>

    <div class="dashboard" id="dashboard">
        <!-- Cards will be added dynamically when characters send updates -->
    </div>

    <script>
        // Initialize Socket.IO connection
        const socket = io();
        let characters = {};
        const INACTIVE_THRESHOLD = 20000; // 20 seconds in milliseconds

        // Connection status handling
        socket.on('connect', function() {
            console.log('Connected to server');
            document.getElementById('connectionStatus').textContent = 'Connected';
            document.getElementById('connectionStatus').className = 'connection-status connected';
        });

        socket.on('disconnect', function() {
            console.log('Disconnected from server');
            document.getElementById('connectionStatus').textContent = 'Disconnected';
            document.getElementById('connectionStatus').className = 'connection-status disconnected';
        });

        // Handle initial characters state
        socket.on('characters_state', function(data) {
            characters = data;
            updateDashboard();
        });

        // Handle individual character updates
        socket.on('character_update', function(data) {
            characters[data.character_name] = data.data;
            updateDashboard();
        });

        // Handle character removal
        socket.on('character_removed', function(data) {
            delete characters[data.character_name];
            updateDashboard();
        });

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        function formatTime(seconds) {
            if (seconds < 60) {
                return seconds + 's';
            } else if (seconds < 3600) {
                return Math.floor(seconds / 60) + 'm ' + (seconds % 60) + 's';
            } else {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                return hours + 'h ' + minutes + 'm';
            }
        }

        function calculateTimeToLevel(expNeeded, hourlyRate) {
            if (!expNeeded || !hourlyRate || hourlyRate <= 0) {
                return 'N/A';
            }
            
            const hoursNeeded = expNeeded / hourlyRate;
            const hours = Math.floor(hoursNeeded);
            const minutes = Math.round((hoursNeeded - hours) * 60);
            
            if (hours === 0) {
                return minutes + 'm';
            }
            
            return hours + 'h ' + minutes + 'm';
        }

        function toggleEffects(characterName) {
            const effectsList = document.getElementById('effects-' + characterName);
            const toggle = document.getElementById('toggle-' + characterName);
            const totalEffects = getTotalEffects(characters[characterName]?.effects);
            
            if (effectsList.classList.contains('expanded')) {
                effectsList.classList.remove('expanded');
                toggle.textContent = `Show Effects (${totalEffects})`;
            } else {
                effectsList.classList.add('expanded');
                toggle.textContent = `Hide Effects (${totalEffects})`;
            }
        }

        function createEffectsSection(effects, characterName) {
            if (!effects) return '';
            
            let effectsHtml = '';
            let totalEffects = 0;
            
            // Count total effects
            if (effects.spells) totalEffects += effects.spells.length;
            if (effects.buffs) totalEffects += effects.buffs.length;
            if (effects.debuffs) totalEffects += effects.debuffs.length;
            if (effects.cooldowns) totalEffects += effects.cooldowns.length;
            
            if (totalEffects === 0) return '';
            
            effectsHtml += `
                <div class="effects-section">
                    <button class="effects-toggle" id="toggle-${characterName}" onclick="toggleEffects('${characterName}')">
                        Show Effects (${totalEffects})
                    </button>
                    <div class="effects-list" id="effects-${characterName}">
            `;
            
            // Add spells
            if (effects.spells && effects.spells.length > 0) {
                effectsHtml += createEffectCategory('Spells', effects.spells, 'spell');
            }
            
            // Add buffs
            if (effects.buffs && effects.buffs.length > 0) {
                effectsHtml += createEffectCategory('Buffs', effects.buffs, 'buff');
            }
            
            // Add debuffs
            if (effects.debuffs && effects.debuffs.length > 0) {
                effectsHtml += createEffectCategory('Debuffs', effects.debuffs, 'debuff');
            }
            
            // Add cooldowns
            if (effects.cooldowns && effects.cooldowns.length > 0) {
                effectsHtml += createEffectCategory('Cooldowns', effects.cooldowns, 'cooldown');
            }
            
            effectsHtml += `
                    </div>
                </div>
            `;
            
            return effectsHtml;
        }

        function createEffectCategory(title, effects, type) {
            let html = `<div class="effect-category">
                <div class="effect-category-title">${title}</div>
            `;
            
            effects.forEach(effect => {
                const maxDuration = 14400; // 4 hours max duration for all spells
                const progressPercent = Math.min((effect.remaining_seconds / maxDuration) * 100, 100);
                
                html += `
                    <div class="effect-bar">
                        <div class="effect-label">
                            <span>${effect.name}</span>
                            <span>${formatTime(effect.remaining_seconds)}</span>
                        </div>
                        <div class="effect-progress">
                            <div class="effect-fill ${type}" style="width: ${progressPercent}%"></div>
                            <div class="effect-time">${formatTime(effect.remaining_seconds)}</div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }

        function getTimeSince(timestamp) {
            const now = Date.now() / 1000;
            const diff = now - timestamp;
            
            if (diff < 60) {
                return Math.floor(diff) + 's ago';
            } else if (diff < 3600) {
                return Math.floor(diff / 60) + 'm ago';
            } else {
                return Math.floor(diff / 3600) + 'h ago';
            }
        }

        function hasInjuries(injuries) {
            if (!injuries || !injuries.wounds) return false;
            
            for (const [part, level] of Object.entries(injuries.wounds)) {
                if (part !== 'nsys' && level > 0) {
                    return true;
                }
            }
            return false;
        }

        function createManequin(injuries) {
            if (!injuries || !injuries.wounds) return '<div class="manequin-container"></div>';
            
            let dotsHtml = '';
            const bodyParts = {
                'head': 'injury-head',
                'neck': 'injury-neck', 
                'chest': 'injury-chest',
                'abdomen': 'injury-abdomen',
                'back': 'injury-back',
                'leftArm': 'injury-leftArm',
                'rightArm': 'injury-rightArm',
                'leftHand': 'injury-leftHand',
                'rightHand': 'injury-rightHand',
                'leftLeg': 'injury-leftLeg',
                'rightLeg': 'injury-rightLeg',
                'leftFoot': 'injury-leftFoot',
                'rightFoot': 'injury-rightFoot',
                'leftEye': 'injury-leftEye',
                'rightEye': 'injury-rightEye'
            };

            for (const [part, className] of Object.entries(bodyParts)) {
                const level = injuries.wounds[part] || 0;
                if (level > 0) {
                    dotsHtml += `<div class="injury-dot injury-level-${level} ${className}"></div>`;
                }
            }

            return `<div class="manequin-container">${dotsHtml}</div>`;
        }

        function createCharacterTile(charName, charData) {
            const currentTime = Date.now() / 1000;
            const lastUpdate = charData.server_timestamp || 0;
            const isInactive = (currentTime - lastUpdate) > (INACTIVE_THRESHOLD / 1000);

            const character = charData.character || {};
            const vitals = charData.vitals || {};
            const status = charData.status || {};
            const experience = charData.experience || {};
            const resources = charData.resources || {};
            const dailyTracking = charData.daily_tracking || {};
            const location = charData.location || {};
            const injuries = charData.injuries || {};
            const effects = charData.effects || {};

            return `
                <div class="character-tile" id="char-${charName}">
                    ${isInactive ? '<div class="inactive-overlay"></div>' : ''}
                    <div class="last-update">${getTimeSince(lastUpdate)}</div>
                    <div class="character-name">${charName}</div>
                    <div class="character-location">
                        <span class="room-title">${location.room_title || 'Unknown Location'}</span><br>
                        Room: ${location.room_id || '??'}
                    </div>
                    
                    <div class="top-section">
                        <div class="manequin-section">
                            ${createManequin(injuries)}
                        </div>
                        <div class="stats-section">
                            <div class="stat-row">
                                <span class="stat-label">Today:</span>
                                <span class="stat-value">${formatNumber(dailyTracking.xp_today || 0)}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">AVG/Hr:</span>
                                <span class="stat-value">${formatNumber(experience.hourly_rate || 0)}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Room:</span>
                                <span class="stat-value">${location.room_id || '??'}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Silver:</span>
                                <span class="stat-value">${formatNumber(dailyTracking.silver_today || 0)}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">TTL:</span>
                                <span class="stat-value">${calculateTimeToLevel(experience.experience_to_next_level, experience.hourly_rate)}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Stance:</span>
                                <span class="stat-value">${status.stance?.text || 'Unknown'}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Encumbrance:</span>
                                <span class="stat-value">${status.encumbrance?.text || 'Unknown'}</span>
                            </div>
                        </div>
                    </div>


                    <div class="vitals-section">
                        ${createVitalBar('Health', vitals.health, 'health')}
                        ${createVitalBar('Mana', vitals.mana, 'mana')}
                        ${createVitalBar('Stamina', vitals.stamina, 'stamina')}
                        ${createVitalBar('Spirit', vitals.spirit, 'spirit')}
                        ${createVitalBar('Mindstate', {
                            current: status.mindstate?.value || 0,
                            max: 100,
                            percent: status.mindstate?.value || 0
                        }, 'mindstate')}
                    </div>

                    <div class="level-section">
                        <div class="progress-label">
                            <span>Level: ${character.level || 0}</span>
                            <span>${formatNumber(experience.experience_to_next_level || 0)} TNL</span>
                        </div>
                        <div class="progress-bar-container" style="position: relative;">
                            <div class="progress-bar-fill level-progress" style="width: ${experience.next_level_percent || 0}%"></div>
                            <div class="progress-text">${experience.next_level_percent || 0}%</div>
                        </div>
                    </div>

                    <div class="capped-section">
                        <div class="progress-label">
                            <span>Experience Cap</span>
                            <span>${(experience.percent_capped || 0).toFixed(1)}%</span>
                        </div>
                        <div class="progress-bar-container" style="position: relative;">
                            <div class="progress-bar-fill capped-progress" style="width: ${Math.min(experience.percent_capped || 0, 100)}%"></div>
                            <div class="progress-text">${(experience.percent_capped || 0).toFixed(1)}%</div>
                        </div>
                    </div>

                    ${createEffectsSection(effects, charName)}
                </div>
            `;
        }

        function createVitalBar(name, vital, className) {
            if (!vital) return '';
            
            const percent = vital.percent || 0;
            const current = vital.current || 0;
            const max = vital.max || 0;

            return `
                <div class="vital-bar">
                    <div class="vital-label">
                        <span>${name}</span>
                        <span>${current}/${max}</span>
                    </div>
                    <div class="bar-container">
                        <div class="bar-fill ${className}" style="width: ${percent}%"></div>
                        <div class="bar-text">${current}/${max}</div>
                    </div>
                </div>
            `;
        }

        function getTotalEffects(effects) {
            if (!effects) return 0;
            let totalEffects = 0;
            if (effects.spells) totalEffects += effects.spells.length;
            if (effects.buffs) totalEffects += effects.buffs.length;
            if (effects.debuffs) totalEffects += effects.debuffs.length;
            if (effects.cooldowns) totalEffects += effects.cooldowns.length;
            return totalEffects;
        }

        function updateDashboard() {
            const dashboard = document.getElementById('dashboard');
            
            const characterCount = Object.keys(characters).length;
            
            if (characterCount === 0) {
                dashboard.innerHTML = '';
                return;
            }

            // Store expanded states before updating
            const expandedStates = {};
            for (const charName of Object.keys(characters)) {
                const effectsList = document.getElementById('effects-' + charName);
                if (effectsList && effectsList.classList.contains('expanded')) {
                    expandedStates[charName] = true;
                }
            }

            // Show character tiles
            let html = '';
            Object.entries(characters).forEach(([charName, charData]) => {
                html += createCharacterTile(charName, charData);
            });
            
            dashboard.innerHTML = html;

            // Restore expanded states
            for (const [charName, isExpanded] of Object.entries(expandedStates)) {
                if (isExpanded) {
                    const effectsList = document.getElementById('effects-' + charName);
                    const toggle = document.getElementById('toggle-' + charName);
                    if (effectsList && toggle) {
                        effectsList.classList.add('expanded');
                        const totalEffects = getTotalEffects(characters[charName]?.effects);
                        toggle.textContent = `Hide Effects (${totalEffects})`;
                    }
                }
            }
        }

        function addTestCharacter() {
            const testCharacter = {
                "character": {
                    "name": "TestBot",
                    "level": 25
                },
                "vitals": {
                    "health": { "current": 88, "max": 100, "percent": 88 },
                    "mana": { "current": 150, "max": 200, "percent": 75 },
                    "stamina": { "current": 60, "max": 60, "percent": 100 },
                    "spirit": { "current": 8, "max": 10, "percent": 80 }
                },
                "status": {
                    "stance": { "text": "Offensive", "value": 60 },
                    "mindstate": { "text": "Clear as a bell", "value": 100 },
                    "encumbrance": { "text": "Light", "value": 25 }
                },
                "injuries": {
                    "wounds": {
                        "nsys": 0, "head": 1, "neck": 0, "chest": 2, "abdomen": 0, "back": 0,
                        "leftArm": 3, "rightArm": 0, "leftHand": 0, "rightHand": 1, 
                        "leftLeg": 0, "rightLeg": 2, "leftFoot": 0, "rightFoot": 0, 
                        "leftEye": 0, "rightEye": 0
                    }
                },
                "location": { 
                    "room_id": 4321,
                    "room_title": "[Test Chamber]"
                },
                "effects": {
                    "spells": [
                        { "name": "Elemental Defense I", "remaining_seconds": 1200, "end_time": Date.now() + 1200000 },
                        { "name": "Stone Skin", "remaining_seconds": 450, "end_time": Date.now() + 450000 },
                        { "name": "Strength", "remaining_seconds": 800, "end_time": Date.now() + 800000 }
                    ],
                    "buffs": [
                        { "name": "Sigil of Focus", "remaining_seconds": 300, "end_time": Date.now() + 300000 }
                    ],
                    "debuffs": [],
                    "cooldowns": [
                        { "name": "Sign of Wracking", "remaining_seconds": 45, "end_time": Date.now() + 45000 }
                    ]
                },
                "experience": {
                    "experience_to_next_level": 25000, "next_level_percent": 45,
                    "percent_capped": 15.5, "last_pulse": 180, "hourly_rate": 6200
                },
                "daily_tracking": {
                    "xp_today": 85000, "silver_today": 320000, "bounty_points": 1250
                },
                "server_timestamp": Date.now() / 1000
            };
            
            characters['TestBot'] = testCharacter;
            updateDashboard();
        }

        // Update dashboard every 2 seconds to check for inactive characters
        setInterval(updateDashboard, 2000);

        // Initial load
        updateDashboard();
    </script>
</body>
</html>